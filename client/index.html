<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/index.css">
    <title>SocketTest</title>
  </head>
  <body>
    <h1>Testing Socket</h1>

    <div id='topSection'>
      <img id="topCard" />
    </div>
    <ul id="cardList">

    </ul>

    <script src="../socket.io/socket.io.js"></script>
    <script>
      var socket = io();
      var cid;
      var number = -1;
      var backCard = document.createElement('img');
      backCard.classList.add('backCard');
      backCard.src = '/cards/back.png';
      backCard.addEventListener('click', function(e){
        socket.emit('takeCard', number);
      });

      socket.on('number', function(num){
        if(number == -1)
          number = num;
      });
      socket.on('cardList', function(players){
        loadCards(players[number]);     
      });
      socket.on('currentCard', function(cid){
        showCurrentCard(cid);    
      });
      socket.on('reset', function(){
        reset();
      });
      function reset(){
        document.getElementById('cardList').innerHTML = ' ';
      }
      function showCurrentCard(c){
        if(c.type == 'normal')
          cid = c.color + c.number;
        else if(c.type == '+4' || c.type == 'color')
          cid = c.type;
        else
          cid = c.color + c.type;
        var card = document.createElement("img");
        card.src = '/cards/' + cid + '.png';
        card.id = cid;
        card.classList.add('topCard');
        document.getElementById('topSection').innerHTML = '';
        document.getElementById('topSection').appendChild(card);
        document.getElementById('topSection').appendChild(backCard);
      }
      function loadCards(cards){
        reset();
        for (var i = 0; i < cards.length; i ++){
          var c = cards[i];
          if(c.type == 'normal')
            cid = c.color + c.number;
          else if(c.type == '+4' || c.type == 'color')
            cid = c.type;
          else
            cid = c.color + c.type;
          var card = document.createElement("img");
          card.src = '/cards/' + cid + '.png';
          card.id = cid;
          card.classList.add('card');
          document.getElementById('cardList').appendChild(card);
          card.addEventListener('click', function(e){
            socket.emit('cardClicked', this.id, number);
          });
        }
      }
    </script>
  </body>
</html>